<!DOCTYPE html>
<html>
<head>
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: Arial, sans-serif;
    background: white;
    padding: 20px;
    font-size: 9pt;
}

.statement-container {
    max-width: 100%;
    margin: 0 auto;
}

/* Company Header Table */
.company-header-table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 30px;
}

.company-name {
    font-weight: bold;
    font-size: 14pt;
    text-align: right;
}

.company-address {
    font-size: 9pt;
    line-height: 1.4;
    text-align: right;
    padding-top: 2px;
}

/* Customer Section Table */
.customer-section-table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 20px;
}

.customer-label {
    background-color: #4a7ba7;
    color: white;
    padding: 8px 15px;
    font-weight: bold;
    font-size: 9pt;
}

.customer-details {
    padding: 10px 15px;
    vertical-align: top;
}

.customer-name-main {
    font-weight: bold;
    font-size: 10pt;
    margin-bottom: 2px;
}

.customer-name-repeat {
    font-size: 9pt;
    margin-bottom: 2px;
}

.customer-contact {
    font-size: 9pt;
    color: #333;
}

/* Account Summary */
.summary-header {
    background-color: #4a7ba7;
    color: white;
    padding: 8px 15px;
    font-weight: bold;
    font-size: 9pt;
}

.summary-dates {
    font-size: 8.5pt;
    font-weight: normal;
    float: right;
}

.summary-table {
    width: 100%;
    border-collapse: collapse;
    background-color: white;
}

.summary-table td {
    padding: 8px 15px;
    font-size: 9pt;
    border-bottom: 1px solid #e0e0e0;
}

.summary-table tr:last-child td {
    border-bottom: none;
    font-weight: bold;
}

.summary-label {
    text-align: left;
}

.summary-value {
    text-align: right;
}

/* Period Header */
.period-header {
    text-align: center;
    font-weight: bold;
    margin: 20px 0 15px 0;
    font-size: 9pt;
}

/* Transaction Table */
.transaction-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 8.5pt;
}

.transaction-table thead {
    background-color: #4a7ba7;
    color: white;
}

.transaction-table thead th {
    padding: 10px 8px;
    text-align: left;
    font-weight: bold;
    border-right: 1px solid white;
    font-size: 8.5pt;
}

.transaction-table thead th:last-child {
    border-right: none;
}

.transaction-table tbody td {
    padding: 10px 8px;
    border: 1px solid #d0d0d0;
    vertical-align: top;
    background-color: #f8f8f8;
}

.transaction-row-white td {
    background-color: white !important;
}

.text-right {
    text-align: right;
}

.text-center {
    text-align: center;
}

/* Product Table */
.product-table-cell {
    padding: 0 !important;
    background-color: #e8e8e8 !important;
}

.product-table {
    width: 100%;
    border-collapse: collapse;
    margin: 0;
    font-size: 8pt;
}

.product-table thead {
    background-color: #4a7ba7;
    color: white;
}

.product-table thead th {
    padding: 8px 6px;
    text-align: left;
    font-weight: bold;
    border-right: 1px solid white;
    font-size: 8pt;
}

.product-table tbody td {
    padding: 8px 6px;
    border: 1px solid #d0d0d0;
    background-color: white;
    font-size: 8pt;
}

@media print {
    body {
        padding: 10px;
    }
}
</style>
</head>
<body>
<div class="statement-container">
    <!-- Company Header -->
    <table class="company-header-table">
        <tr>
            <td class="company-name">
                {{ doc.company or "4S INDUSTRES LTD" }}
            </td>
        </tr>
        <tr>
            <td class="company-address">
                {% set company_doc = frappe.get_doc("Company", doc.company) %}
                , {{ company_doc.city or "Kampala" }}, {{ company_doc.country or "Central Uganda" }}, {{ company_doc.pincode or "126876" }}
            </td>
        </tr>
    </table>

    <!-- Customer and Summary Section -->
    <table class="customer-section-table">
        <tr>
            <!-- Customer Box -->
            <td style="width: 30%; vertical-align: top;">
                <table style="width: 100%; border-collapse: collapse;">
                    <tr>
                        <td class="customer-label">To:</td>
                    </tr>
                    <tr>
                        <td class="customer-details">
                            <div class="customer-name-main">{{ (doc.customer_name or doc.customer)|upper }}</div>
                            <div class="customer-name-repeat">{{ doc.customer_name or doc.customer }}</div>
                            {% if doc.contact_mobile %}
                            <div class="customer-contact">Mobile: {{ doc.contact_mobile }}</div>
                            {% elif doc.contact_person %}
                                {% set contact_mobile = frappe.db.get_value("Contact", doc.contact_person, "mobile_no") %}
                                {% if contact_mobile %}
                                <div class="customer-contact">Mobile: {{ contact_mobile }}</div>
                                {% endif %}
                            {% endif %}
                        </td>
                    </tr>
                </table>
            </td>

            <!-- Spacer -->
            <td style="width: 5%;"></td>

            <!-- Account Summary Box -->
            <td style="width: 65%; vertical-align: top;">
                <table style="width: 100%; border-collapse: collapse;">
                    <tr>
                        <td class="summary-header" colspan="2">
                            Account Summary
                            <span class="summary-dates">01/01/2024 To 31/12/2024</span>
                        </td>
                    </tr>
                </table>
                <table class="summary-table">
                    <tr>
                        <td class="summary-label">Opening Balance</td>
                        <td class="summary-value">{{ doc.currency }} 0</td>
                    </tr>
                    <tr>
                        <td class="summary-label">Total invoice</td>
                        <td class="summary-value">{{ doc.currency }} {{ "{:,.0f}".format(doc.grand_total) }}</td>
                    </tr>
                    <tr>
                        <td class="summary-label">Paid Amount</td>
                        <td class="summary-value">{{ doc.currency }} {{ "{:,.0f}".format(doc.paid_amount or 0) }}</td>
                    </tr>
                    <tr>
                        <td class="summary-label">Credit</td>
                        <td class="summary-value">{{ doc.currency }} {{ "{:,.0f}".format(doc.grand_total - (doc.paid_amount or 0)) }}</td>
                    </tr>
                    <tr>
                        <td class="summary-label">Balance due</td>
                        <td class="summary-value">{{ doc.currency }} {{ "{:,.0f}".format(doc.outstanding_amount) }}</td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>

    <!-- Period Header -->
    <div class="period-header">
        Showing all invoices and payments between 01/01/2024 and 31/12/2024
    </div>

    <!-- Transaction Table -->
    <table class="transaction-table">
        <thead>
            <tr>
                <th style="width: 12%;">Date</th>
                <th style="width: 7%;">Ref No.</th>
                <th style="width: 8%;">Type</th>
                <th style="width: 9%;">Location</th>
                <th style="width: 9%;">Payment<br>Status</th>
                <th style="width: 11%;" class="text-right">Debit</th>
                <th style="width: 11%;" class="text-right">Credit</th>
                <th style="width: 10%;" class="text-right">Balance</th>
                <th style="width: 11%;">Payment<br>Method</th>
                <th style="width: 12%;">Notes</th>
            </tr>
        </thead>
        <tbody>
            <!-- Opening Balance Row -->
            <tr>
                <td>{{ frappe.utils.formatdate(doc.posting_date, "dd/MM/yyyy") }} 12:00 AM</td>
                <td></td>
                <td>Opening<br>Balance</td>
                <td></td>
                <td></td>
                <td class="text-right">{{ doc.currency }} 0</td>
                <td class="text-right"></td>
                <td class="text-right">0</td>
                <td></td>
                <td></td>
            </tr>

            <!-- Invoice Row -->
            <tr>
                <td>{{ frappe.utils.formatdate(doc.posting_date, "dd/MM/yyyy") }} {{ (doc.posting_time|string if doc.posting_time else "09:16")[:5] }} AM</td>
                <td>{{ doc.name.split("-")[-1] if "-" in doc.name else doc.name }}</td>
                <td>Invoice</td>
                <td>{{ doc.set_warehouse or "4S Spare Parts" }}</td>
                <td>{{ "Paid" if doc.status == "Paid" else "NOT PAID" }}</td>
                <td class="text-right">{{ doc.currency }}<br>{{ "{:,.0f}".format(doc.grand_total) }}</td>
                <td class="text-right"></td>
                <td class="text-right">{{ "{:,.0f}".format(doc.grand_total) }}<br>DR</td>
                <td></td>
                <td>{{ "NOT PAID" if doc.status != "Paid" else "" }}</td>
            </tr>

            <!-- Product Details Row -->
            <tr class="transaction-row-white">
                <td colspan="10" class="product-table-cell">
                    <table class="product-table">
                        <thead>
                            <tr>
                                <th style="width: 3%; text-align: center;">#</th>
                                <th style="width: 25%;">Product</th>
                                <th style="width: 10%; text-align: right;">Quantity</th>
                                <th style="width: 12%; text-align: right;">Unit Price</th>
                                <th style="width: 10%; text-align: right;">Discount</th>
                                <th style="width: 8%; text-align: right;">Tax</th>
                                <th style="width: 14%; text-align: right;">Price Inc. tax</th>
                                <th style="width: 18%; text-align: right;">Subtotal</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in doc.items %}
                            <tr>
                                <td style="text-align: center;">{{ loop.index }}</td>
                                <td>{{ item.item_name }} {{ item.item_code }}</td>
                                <td style="text-align: right;">{{ "{:,.0f}".format(item.qty) }} Pc(s)</td>
                                <td style="text-align: right;">{{ doc.currency }} {{ "{:,.0f}".format(item.rate) }}</td>
                                <td style="text-align: right;">{{ doc.currency }} {{ "{:,.0f}".format(item.discount_amount or 0) }}</td>
                                <td style="text-align: right;">{{ doc.currency }} 0</td>
                                <td style="text-align: right;">{{ doc.currency }} {{ "{:,.0f}".format(item.rate) }}</td>
                                <td style="text-align: right;">{{ doc.currency }} {{ "{:,.0f}".format(item.amount) }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </td>
            </tr>

            <!-- Payment Rows -->
            {% set payments = frappe.get_all("Payment Entry Reference", filters={"reference_name": doc.name, "docstatus": 1}, fields=["parent"]) %}
            {% for payment_ref in payments %}
                {% set payment = frappe.get_doc("Payment Entry", payment_ref.parent) %}
                <tr class="transaction-row-white">
                    <td>{{ frappe.utils.formatdate(payment.posting_date, "dd/MM/yyyy") }} {{ (payment.posting_time|string if payment.posting_time else "10:13")[:5] }} AM</td>
                    <td>{{ payment.name.split("-")[-1] if "-" in payment.name else payment.name }}</td>
                    <td>Payment</td>
                    <td></td>
                    <td></td>
                    <td class="text-right"></td>
                    <td class="text-right">{{ doc.currency }}<br>{{ "{:,.0f}".format(payment.paid_amount) }}</td>
                    <td class="text-right">{{ "{:,.0f}".format(doc.outstanding_amount) }}<br>{% if doc.outstanding_amount > 0 %}DR{% else %}CR{% endif %}</td>
                    <td>Bank<br>Transfer</td>
                    <td>Advance payment</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
</body>
</html>