<!DOCTYPE html>
<html>
<head>
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}
body {
    font-family: Arial, sans-serif;
    background: white;
    padding: 10px;
    font-size: 9pt;
}
.invoice-page {
    width: 80%;
    margin: 0 auto;
    background: white;
    position: relative;
}
/* Background Logo */
.background-logo {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    opacity: 0.05;
    z-index: 0;
    max-width: 400px;
    max-height: 400px;
}
.content-wrapper {
    position: relative;
    z-index: 1;
}
.invoice-title {
    text-align: center;
    font-size: 18pt;
    font-weight: bold;
    margin-bottom: 5px;
    letter-spacing: 3px;
}
.main-table {
    width: 100%;
    border-collapse: collapse;
    border: 2px solid #000;
}
/* Header Section */
.header-cell {
    border-bottom: 2px solid #000;
    padding: 8px 10px;
}
.company-name {
    font-weight: bold;
    font-size: 10pt;
    margin-bottom: 1px;
}
.company-phone {
    font-size: 8.5pt;
}
/* Left column */
.left-col {
    width: 50%;
    border-right: 2px solid #000;
    padding: 10px 12px;
    vertical-align: top;
}
/* Right side grid cells */
.right-grid-cell {
    border-right: 1px solid #000;
    border-bottom: 1px solid #000;
    padding: 4px 8px;
    font-size: 8.5pt;
    vertical-align: top;
    line-height: 1.3;
    width: 25%;
}
.right-grid-cell-last {
    border-bottom: 1px solid #000;
    padding: 4px 8px;
    font-size: 8.5pt;
    vertical-align: top;
    line-height: 1.3;
    width: 25%;
}
.no-border-bottom {
    border-bottom: none !important;
}
.consignee-section {
    margin-bottom: 25px;
}
.buyer-section {
    margin-bottom: 0;
}
.section-label {
    font-size: 8.5pt;
    margin-bottom: 3px;
    color: #000;
}
.section-value {
    font-size: 10pt;
    font-weight: bold;
    line-height: 1.3;
}
/* Items table header */
.items-header {
    border-top: 2px solid #000;
    border-bottom: 2px solid #000;
}
.items-header td {
    padding: 6px 4px;
    text-align: center;
    font-size: 9.5pt;
    font-weight: normal;
    vertical-align: middle;
}
/* Items body */
.items-row td {
    padding: 5px 6px;
    font-size: 9.5pt;
    vertical-align: top;
    line-height: 1.4;
}
.col-sl {
    width: 5%;
    text-align: center;
    border-right: 1px solid #000;
}
.col-desc {
    width: 35%;
    padding-left: 8px;
    text-align: left;
    border-right: 1px solid #000;
}
.col-qty {
    width: 18%;
    text-align: right;
    padding-right: 12px;
    border-right: 1px solid #000;
}
.col-rate {
    width: 15%;
    text-align: right;
    padding-right: 12px;
    border-right: 1px solid #000;
}
.col-per {
    width: 10%;
    text-align: center;
    border-right: 1px solid #000;
}
.col-amount {
    width: 17%;
    text-align: right;
    padding-right: 12px;
}
.item-main {
    font-weight: bold;
    font-size: 9.5pt;
}
/* Total row */
.total-row {
    border-top: 2px solid #000;
    border-bottom: 2px solid #000;
}
.total-row td {
    padding: 6px 10px;
    text-align: right;
}
.total-label-cell {
    text-align: right;
    font-size: 10pt;
    font-weight: normal;
}
.total-amount-cell {
    text-align: right;
    font-size: 10pt;
    padding-right: 12px;
    font-weight: normal;
}
.eoe-text {
    font-size: 8pt;
    display: block;
    margin-top: 2px;
}
/* Amount in words */
.words-row td {
    border-bottom: 2px solid #000;
    padding: 8px 10px;
}
.words-label {
    font-size: 8.5pt;
    margin-bottom: 3px;
}
.words-value {
    font-size: 10pt;
    font-weight: bold;
}
@media print {
    body {
        padding: 0;
    }
    .invoice-page {
        margin: 0;
    }
}
</style>
</head>
<body>
<div class="invoice-page">
    <!-- Background Logo -->
    {% set company_logo = frappe.db.get_value("Company", doc.company, "company_logo") %}
    {% if company_logo %}
    <img src="{{ company_logo }}" class="background-logo" alt="Company Logo">
    {% endif %}
    
    <div class="content-wrapper">
        <div class="invoice-title">INVOICE</div>
        
        <table class="main-table">
            <!-- Company Header -->
            <tr>
                <td colspan="3" class="header-cell">
                    <div class="company-name">{{ doc.company }}</div>
                    {% set phone = frappe.db.get_value("Company", doc.company, "phone_no") %}
                    {% if phone %}
                    <div class="company-phone">Tel: {{ phone }}</div>
                    {% endif %}
                </td>
            </tr>

            <!-- Row 1 -->
            <tr>
                <td class="left-col" rowspan="7">
                    <div class="consignee-section">
                        <div class="section-label">Consignee</div>
                        <div class="section-value">
                            {{ doc.customer_name or doc.customer }}<br>
                            {% if doc.shipping_address_name %}
                            {{ frappe.db.get_value("Address", doc.shipping_address_name, "address_line1") or "" }}
                            {% endif %}
                        </div>
                    </div>

                    <div class="buyer-section">
                        <div class="section-label">Buyer (if other than consignee)</div>
                        <div class="section-value">
                            {{ doc.customer_name or doc.customer }}<br>
                            {% if doc.customer_address %}
                            {{ doc.address_display or "" }}
                            {% endif %}
                        </div>
                    </div>
                </td>
                <td class="right-grid-cell">
                    Invoice No.<br>
                    <strong>{{ doc.name }}</strong>
                </td>
                <td class="right-grid-cell-last">
                    Dated<br>
                    <strong>{{ frappe.utils.formatdate(doc.posting_date, "dd-MMM-yyyy") }}</strong>
                </td>
            </tr>

            <!-- Row 2 -->
            <tr>
                <td class="right-grid-cell">
                    Delivery Note<br>
                    <strong>{{ doc.delivery_note or "" }}</strong>
                </td>
                <td class="right-grid-cell-last">
                    Mode/Terms of Payment<br>
                    <strong>{{ doc.payment_terms_template or "" }}</strong>
                </td>
            </tr>

            <!-- Row 3 -->
            <tr>
                <td class="right-grid-cell">
                    Supplier's Ref.<br>
                    <strong>{{ doc.supplier or "" }}</strong><br>
                </td>
                <td class="right-grid-cell-last">
                    Other Reference(s)<br>
                    <strong></strong>
                </td>
            </tr>

        

            <!-- Row 5 -->
            <tr>
                <td class="right-grid-cell">
                    Buyer's Order No.<br>
                    <strong>{{ doc.po_no or "" }}</strong>
                </td>
                <td class="right-grid-cell-last">
                    Dated<br>
                    <strong>{{ frappe.utils.formatdate(doc.po_date, "dd-MMM-yyyy") if doc.po_date else "" }}</strong>
                </td>
            </tr>

            <!-- Row 6 -->
            <tr>
                <td class="right-grid-cell">
                    Despatch Document No.<br>
                    <strong>{{ doc.lr_no or "" }}</strong>
                </td>
                <td class="right-grid-cell-last">
                    Dated<br>
                    <strong></strong>
                </td>
            </tr>


            <!-- Row 8 -->
            <tr>
                <td class="right-grid-cell">
                    Despatched through<br>
                    <strong>{{ doc.transporter_name or "" }}</strong>
                </td>
                <td class="right-grid-cell-last">
                    Destination<br>
                    <strong>{{ doc.shipping_address_name or "" }}</strong>
                </td>
            </tr>


            <!-- Row 11 -->
            <tr>
                <td >
                    Terms of Delivery<br>
                    <strong>{{ doc.delivery_date or "" }}</strong>
                </td>
            </tr>

            

            
            
            <!-- Items Table Header -->
            <tr class="items-header">
                <td colspan="3" style="padding: 0;">
                    <table style="width: 100%; border-collapse: collapse; margin: 0;">
                        <tr>
                            <td class="col-sl" style="border: none; padding: 6px 4px;">Sl<br>No</td>
                            <td class="col-desc" style="border: none; padding: 6px 4px;">Description of Goods</td>
                            <td class="col-qty" style="border: none; padding: 6px 4px;">Quantity</td>
                            <td class="col-rate" style="border: none; padding: 6px 4px;">Rate</td>
                            <td class="col-per" style="border: none; padding: 6px 4px;">per</td>
                            <td class="col-amount" style="border: none; padding: 6px 4px;">Amount</td>
                        </tr>
                    </table>
                </td>
            </tr>

            <!-- Item Rows -->
            {% for item in doc.items %}
            <tr class="items-row">
                <td colspan="3" style="padding: 0;">
                    <table style="width: 100%; border-collapse: collapse; margin: 0;">
                        <tr>
                            <td class="col-sl" style="border: none; padding: 5px 6px;">{{ loop.index }}</td>
                            <td class="col-desc" style="border: none; padding: 5px 6px;">
                                <span class="item-main">{{ item.item_name }}</span>
                                {% if item.description and item.description != item.item_name %}
                                <br><span style="font-size: 8.5pt;">{{ item.description }}</span>
                                {% endif %}
                            </td>
                            <td class="col-qty" style="border: none; padding: 5px 6px;">
                                {{ "{:,.0f}".format(item.qty) }} {{ item.uom or "pcs" }}
                                {% if item.stock_uom and item.stock_uom != item.uom %}
                                <br>{{ "{:,.2f}".format(item.qty * (item.conversion_factor or 1)) }} {{ item.stock_uom }}
                                {% endif %}
                            </td>
                            <td class="col-rate" style="border: none; padding: 5px 6px;">
                                {{ "{:,.0f}".format(item.rate) }}
                                {% if item.base_rate and item.base_rate != item.rate %}
                                <br>{{ "{:,.0f}".format(item.base_rate) }}
                                {% endif %}
                            </td>
                            <td class="col-per" style="border: none; padding: 5px 6px;">
                                {{ item.uom or "pcs" }}
                                {% if item.stock_uom and item.stock_uom != item.uom %}
                                <br>{{ item.stock_uom }}
                                {% endif %}
                            </td>
                            <td class="col-amount" style="border: none; padding: 5px 6px;">
                                {{ "{:,.0f}".format(item.amount) }}
                                {% if item.base_amount and item.base_amount != item.amount %}
                                <br>{{ "{:,.0f}".format(item.base_amount) }}
                                {% endif %}
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
            {% endfor %}

            <!-- Empty rows -->
            {% set total_items = doc.items|length %}
            {% set empty_rows = 5 - total_items %}
            {% for i in range(empty_rows if empty_rows > 0 else 0) %}
            <tr class="items-row" style="">
                <td colspan="3" style="padding: 0;">
                    <table style="width: 100%; border-collapse: collapse; margin: 0;">
                        <tr>
                            <td class="col-sl" style="border: none; padding: 5px 6px;">&nbsp;</td>
                            <td class="col-desc" style="border: none; padding: 5px 6px;">&nbsp;</td>
                            <td class="col-qty" style="border: none; padding: 5px 6px;">&nbsp;</td>
                            <td class="col-rate" style="border: none; padding: 5px 6px;">&nbsp;</td>
                            <td class="col-per" style="border: none; padding: 5px 6px;">&nbsp;</td>
                            <td class="col-amount" style="border: none; padding: 5px 6px;">&nbsp;</td>
                        </tr>
                    </table>
                </td>
            </tr>
            {% endfor %}

            <!-- Total Row -->
            <tr class="total-row">
                <td colspan="3" style="padding: 0;">
                    <table style="width: 100%; border-collapse: collapse; margin: 0;">
                        <tr>
                            <td colspan="5" class="total-label-cell" style="border: none; padding: 6px 10px;">Total</td>
                            <td class="total-amount-cell" style="border: none; padding: 6px 10px;">
                                {% if doc.currency == "UGX" %}ushs{% else %}{{ doc.currency.lower() }}{% endif %} {{ "{:,.0f}".format(doc.grand_total) }}
                                <span class="eoe-text">E & O.E</span>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>

            <!-- Amount in Words -->
            <tr class="words-row">
                <td colspan="3">
                    <div class="words-label">Amount Chargeable (in words)</div>
                    <div class="words-value">{{ frappe.utils.money_in_words(doc.grand_total, doc.currency) }}</div>
                </td>
            </tr>
        </table>
    </div>
</div>
</body>
</html>