<div class="tally-invoice-print">
	<style>
		.tally-invoice-print {
			font-family: Arial, sans-serif;
			font-size: 10pt;
			color: #000;
			padding: 10px;
			max-width: 210mm;
			margin: 0 auto;
			background: white;
		}

		.invoice-header {
			text-align: center;
			font-size: 16pt;
			font-weight: bold;
			margin-bottom: 1px;
			padding-bottom: 1px;
		}

		.invoice-container {
			border: 2px solid #000;
			position: relative;
		}

		.watermark {
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			opacity: 0.1;
			z-index: 0;
			pointer-events: none;
		}

		.watermark img {
			max-width: 400px;
			max-height: 400px;
			width: auto;
			height: auto;
		}

		.header-section,
		.info-grid,
		.items-table,
		.total-section,
		.amount-words-section {
			position: relative;
			z-index: 1;
			background: transparent;
		}

		.header-section {
			border-bottom: 2px solid #000;
			min-height: 60px;
			padding: 6px 10px;
		}

		.company-name {
			font-weight: bold;
			font-size: 10pt;
			margin-bottom: 1px;
		}

		.company-phone {
			font-size: 8pt;
			margin-bottom: 10px;
		}

		.info-grid {
			display: grid;
			grid-template-columns: 1fr 1fr;
			border-bottom: 2px solid #000;
		}

		.left-column {
			padding: 8px 10px;
			border-right: 2px solid #000;
		}

		.right-column {
			display: grid;
			grid-template-columns: 1fr 1fr 1fr 1fr;
		}

		.info-label {
			font-size: 8pt;
			color: #000;
			margin-bottom: 3px;
			font-weight: normal;
		}

		.info-value {
			font-weight: bold;
			font-size: 9pt;
			margin-bottom: 10px;
			line-height: 1.3;
		}

		.right-row {
			display: contents;
		}

		.right-cell-label {
			padding: 4px 8px;
			font-size: 8pt;
			border-bottom: 1px solid #000;
			border-right: 1px solid #000;
			display: flex;
			align-items: center;
		}

		.right-cell-value {
			padding: 4px 8px;
			font-size: 9pt;
			border-bottom: 1px solid #000;
			display: flex;
			align-items: center;
		}

		.items-table {
			width: 100%;
			border-collapse: collapse;
		}

		.items-table thead {
			border-bottom: 2px solid #000;
		}

		.items-table th {
			padding: 6px 4px;
			font-weight: normal;
			font-size: 8pt;
			text-align: center;
			border-right: 1px solid #000;
		}

		.items-table th:first-child {
			border-left: none;
		}

		.items-table th:last-child {
			border-right: none;
		}

		.items-table td {
			padding: 5px 6px;
			font-size: 9pt;
			border-right: 1px solid #000;
			vertical-align: top;
		}

		.items-table td:first-child {
			border-left: none;
		}

		.items-table td:last-child {
			border-right: none;
		}

		.items-table .sno-col {
			width: 5%;
			text-align: center;
		}

		.items-table .desc-col {
			width: 40%;
			padding-left: 10px;
		}

		.items-table .qty-col {
			width: 15%;
			text-align: right;
			padding-right: 15px;
		}

		.items-table .rate-col {
			width: 13%;
			text-align: right;
			padding-right: 15px;
		}

		.items-table .per-col {
			width: 12%;
			text-align: center;
		}

		.items-table .amount-col {
			width: 15%;
			text-align: right;
			padding-right: 15px;
		}

		.item-desc-main {
			font-weight: bold;
			font-size: 9pt;
		}

		.item-desc-sub {
			font-size: 8pt;
			color: #333;
			margin-top: 2px;
		}

		.qty-main {
			font-size: 9pt;
		}

		.qty-sub {
			font-size: 8pt;
			color: #333;
			margin-top: 2px;
		}

		.total-section {
			border-top: 2px solid #000;
			padding: 8px 10px;
			text-align: right;
			font-size: 10pt;
		}

		.total-label {
			display: inline-block;
			width: 80%;
			text-align: right;
			padding-right: 20px;
		}

		.total-amount {
			display: inline-block;
			width: 15%;
			text-align: right;
			font-weight: bold;
		}

		.eoe-text {
			font-size: 8pt;
			color: #666;
			margin-top: 2px;
		}

		.amount-words-section {
			border-top: 2px solid #000;
			padding: 8px 10px;
		}

		.amount-words-label {
			font-size: 8pt;
			margin-bottom: 4px;
		}

		.amount-words-value {
			font-weight: bold;
			font-size: 9pt;
		}

		@media print {
			.tally-invoice-print {
				padding: 0;
			}
			
			@page {
				margin: 10mm;
				size: A4;
			}
			
			.invoice-container {
				page-break-inside: avoid;
			}
		}
	</style>

	<div class="invoice-header">INVOICE</div>

	<div class="invoice-container">
		<!-- Watermark -->
		{% set company_logo = frappe.db.get_value("Company", doc.company, "company_logo") %}
		{% if company_logo %}
		<div class="watermark">
			<img src="{{ company_logo }}" alt="Company Logo">
		</div>
		{% endif %}

		<!-- Header with company info -->
		<div class="header-section">
			<div class="company-name">{{ doc.company }}</div>
			{% if frappe.db.get_value("Company", doc.company, "phone_no") %}
			<div class="company-phone">Tel: {{ frappe.db.get_value("Company", doc.company, "phone_no") }}</div>
			{% endif %}
		</div>

		<!-- Info Grid Section -->
		<div class="info-grid">
			<!-- Left Column -->
			<div class="left-column">
				<div>
					<div class="info-label">Consignee</div>
					<div class="info-value">
						{{ doc.customer_name or doc.customer }}<br>
						{% if doc.shipping_address_name %}
							{{ frappe.db.get_value("Address", doc.shipping_address_name, "address_line1") or "" }}
						{% endif %}
					</div>
				</div>

				<div>
					<div class="info-label">Buyer (if other than consignee)</div>
					<div class="info-value">
						{{ doc.customer_name or doc.customer }}<br>
						{% if doc.customer_address %}
							{{ doc.address_display or "" }}
						{% endif %}
					</div>
				</div>
			</div>

			<!-- Right Column Grid -->
			<div class="right-column">
				<div class="right-cell-label">Invoice No.</div>
				<div class="right-cell-value">{{ doc.name }}</div>
				<div class="right-cell-label">Dated</div>
				<div class="right-cell-value">{{ frappe.utils.formatdate(doc.posting_date, "dd-MMM-yyyy") }}</div>

				<div class="right-cell-label">Delivery Note</div>
				<div class="right-cell-value">{{ doc.delivery_note or "" }}</div>
				<div class="right-cell-label">Mode/Terms of Payment</div>
				<div class="right-cell-value">{{ doc.payment_terms_template or "" }}</div>

				<div class="right-cell-label">Supplier's Ref.</div>
				<div class="right-cell-value">{{ doc.po_no or "" }}</div>
				<div class="right-cell-label">Other Reference(s)</div>
				<div class="right-cell-value">{{ doc.remarks or "" }}</div>

				<div class="right-cell-label">Buyer's Order No.</div>
				<div class="right-cell-value">{{ doc.po_no or "" }}</div>
				<div class="right-cell-label">Dated</div>
				<div class="right-cell-value">{{ frappe.utils.formatdate(doc.po_date, "dd-MMM-yyyy") if doc.po_date else "" }}</div>

				<div class="right-cell-label">Despatch Document No.</div>
				<div class="right-cell-value">{{ doc.lr_no or "" }}</div>
				<div class="right-cell-label">Dated</div>
				<div class="right-cell-value">{{ frappe.utils.formatdate(doc.lr_date, "dd-MMM-yyyy") if doc.lr_date else "" }}</div>

				<div class="right-cell-label">Despatched through</div>
				<div class="right-cell-value">{{ doc.transporter_name or "" }}</div>
				<div class="right-cell-label">Destination</div>
				<div class="right-cell-value">{{ doc.shipping_address_name or "" }}</div>

				<div class="right-cell-label">Terms of Delivery</div>
				<div class="right-cell-value">{{ doc.delivery_date or "" }}</div>
				<div class="right-cell-label" style="border-bottom: none;"></div>
				<div class="right-cell-value" style="border-bottom: none;"></div>
			</div>
		</div>

		<!-- Items Table -->
		<table class="items-table">
			<thead>
				<tr>
					<th class="sno-col">Sl<br>No</th>
					<th class="desc-col">Description of Goods</th>
					<th class="qty-col">Quantity</th>
					<th class="rate-col">Rate</th>
					<th class="per-col">per</th>
					<th class="amount-col">Amount</th>
				</tr>
			</thead>
			<tbody>
				{% for item in doc.items %}
				<tr>
					<td class="sno-col">{{ loop.index }}</td>
					<td class="desc-col">
						<div class="item-desc-main">{{ item.item_name or item.item_code }}</div>
						{% if item.description and item.description != item.item_name %}
						<div class="item-desc-sub">{{ item.description }}</div>
						{% endif %}
					</td>
					<td class="qty-col">
						<div class="qty-main">{{ "%.0f" | format(item.qty) }} {{ item.uom|lower }}</div>
						<div class="qty-sub">{{ "%.2f" | format(item.stock_qty) }} {{ item.stock_uom|lower }}</div>
					</td>
					<td class="rate-col">
						<div class="qty-main">{{ "{:,.0f}".format(item.rate) }}</div>
						<div class="qty-sub">{{ "{:,.0f}".format(item.base_rate) }}</div>
					</td>
					<td class="per-col">
						<div class="qty-main">{{ item.uom|lower }}</div>
						<div class="qty-sub">{{ item.stock_uom|lower }}</div>
					</td>
					<td class="amount-col">
						<div class="qty-main">{{ "{:,.0f}".format(item.amount) }}</div>
						<div class="qty-sub">{{ "{:,.0f}".format(item.base_amount) }}</div>
					</td>
				</tr>
				{% endfor %}

				<!-- Empty rows -->
				{% set filled = doc.items|length %}
				{% set empty_rows = 6 %}
				{% for i in range(empty_rows) %}
				<tr>
					<td class="sno-col">&nbsp;</td>
					<td class="desc-col">&nbsp;</td>
					<td class="qty-col">&nbsp;</td>
					<td class="rate-col">&nbsp;</td>
					<td class="per-col">&nbsp;</td>
					<td class="amount-col">&nbsp;</td>
				</tr>
				{% endfor %}
			</tbody>
		</table>

		<!-- Total Section -->
		<div class="total-section">
			<span class="total-label">Total</span>
			<span class="total-amount">
				{{ doc.currency|lower }} {{ "{:,.0f}".format(doc.grand_total) }}<br>
				<span class="eoe-text">E & O.E</span>
			</span>
		</div>

		<!-- Amount in Words -->
		<div class="amount-words-section">
			<div class="amount-words-label">Amount Chargeable (in words)</div>
			<div class="amount-words-value">
				{{ frappe.utils.money_in_words(doc.grand_total, doc.currency) }}
			</div>
		</div>
	</div>
</div>